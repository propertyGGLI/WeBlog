<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/blogcontent.css">
    <link rel="stylesheet" href="css/layer.css">
    <link rel="stylesheet" href="css/daohang.css">
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="css/insert.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/jquery.sinaEmotion.css">
</head>
<body style="background: #999999">
<div id="result">
    <div blogid="blogid" userid="userid" userna="userna" class="blogcontent_main" >
        <div class="blogcontent_head">
            <img src="" alt="">
        </div>
        <div class="blogcontent_sanjiao"></div>
        <div class="blogcontent_body">
            <div class="blogcontent_username"><a href=""></a></div>
            <div class="blogcontent_word"><p></p></div>
            <div class="blogcontent_photo">
            </div>
            <div class="blogcontent_bottom">
                <div class="blogcontent_button">
                    <span class="blogcontent_button_span"><a  class="blogcontent_button_a">收藏(3)</a></span>
                    <span class="blogcontent_button_span"><a id="forward"  class="forward blogcontent_button_a">转发(6)</a></span>
                    <span class="blogcontent_button_span"><a  class="blogcontent_button_a">评论(1)</a></span>
                    <span class="blogcontent_button_span"><a  class="blogcontent_button_a"><img src="images/nolike.png" alt=""><span class="blogcontent_button_zan_num"></span></a></span>
                </div>
            </div>
        </div>
        <div class="blogcontent_shoucang">
            <ul>
                <li>
                    <div class="blogcontent_shoucang_demo"></div>
                </li>
                <li>
                    <div class="blogcontent_shoucang_demo"></div>
                </li>
            </ul>
        </div>
        <div class="blogcontent_pinglun">
            <div class="blogcontent_pinglun_text">
                <div><span>评论</span></div>
                <div><textarea name="" id="" cols="30" rows="10"></textarea></div>
                <div><input type="submit"></div>
            </div>
            <ul>
                <li>
                    <div class="blogcontent_pinglun_demo">666</div>
                </li>
            </ul>
        </div>
        <div class="blogcontent_util"></div>
    </div>
</div>
</body>
<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
<script type="text/javascript" src="js/blog_publish.js"></script>
<script type="text/javascript" src="layui/layui.all.js"></script>
<script src="js/jquery.sinaEmotion.js"></script>
<script>
    $(function () {
        var old_main = $(".blogcontent_main").detach();
        load();//ajax异步提交，下面的方法被提前执行，故表情没有出现
        $('#result').parseEmotion();
        function load(){
            $.ajax({
                url:"/ShowContentServlet",
                type:"post",
                async:false,
                dataType:"json",
                success:function (result) {
                    var re =result;
                    for (var i=0;i<result.length;i++){
                        var blogid = result[i].BLOG_ID;
                        var new_main = old_main.clone(true);
                        $("#result").append(new_main);
                        new_main.attr("blogid",blogid);
                        new_main.attr("userid",result[i].USER_ID);
                        new_main.attr("userna",result[i].USER_NAME);
                        $(".blogcontent_shoucang").hide();
                        if (re[i].BLOG_IMG==""){
                            new_main.children().eq(0).children().attr("src",result[i].HEAD_IMG);
                            new_main.children().eq(2).children().eq(0).children().text(result[i].USER_NAME);
                            new_main.children().eq(2).children().eq(1).children().text(result[i].BLOG_TEXT);
                        }else {
                            var img = JSON.parse(re[i].BLOG_IMG);
                            new_main.children().eq(0).children().attr("src",result[i].HEAD_IMG);
                            new_main.children().eq(2).children().eq(0).children().text(result[i].USER_NAME);
                            new_main.children().eq(2).children().eq(1).children().text(result[i].BLOG_TEXT);
                            $.ajax({
                                url:"/ShowBlogLikeServlet",
                                type:"post",
                                data:{"blog_id":blogid},
                                dataType:"json",
                                success:function (result) {
                                    // var num = result;
                                    // new_main.children().eq(2).children().eq(3).children().children().eq(3).children().children(1).test(num);
                                }
                            })
                            for (var j=0;j<img.length;j++){
                                var $node = ('<img src="'+img[j]+'" alt="" width="110px" height="110px" style="margin: 2px">')
                                new_main.children().eq(2).children().eq(2).append($node);
                            }
                        }
                    }

                }
            })
        }

    })
</script>
</html>